{% extends 'base.html' %}

{% block title %}Login - GamifyLearn{% endblock %}

{% block meta_description %}Sign in to your GamifyLearn account and continue your personalized learning journey with AI-powered adaptive education.{% endblock %}

{% block extra_head %}
<style>
    /* Auth Layout */
    .auth-container {
        max-width: 400px;
        margin: 2rem auto;
        
    }
    
    .auth-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .auth-icon {
        font-size: 3rem;
        color: var(--primary);
        margin-bottom: 1rem;
    }
    
    .auth-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .auth-subtitle {
        color: var(--text-secondary);
        margin-bottom: 0;
    }
    
    /* Form Styles */
    .auth-form .form-group {
        margin-bottom: 1.5rem;
        position: relative;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-primary);
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--border-light);
        border-radius: 8px;
        font-size: 1rem;
        transition: all var(--transition-base);
        background-color: var(--bg-primary);
        color: var(--text-primary);
    }
    
    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(88, 204, 2, 0.15);
        outline: none;
    }
    
    .password-field-wrapper {
        position: relative;
    }
    
    .password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-tertiary);
        cursor: pointer;
        padding: 0.25rem;
        font-size: 1rem;
        transition: color 0.2s ease;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
    }
    
    .password-toggle:hover {
        background-color: var(--bg-tertiary);
    }
    
    .password-toggle:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(88, 204, 2, 0.2);
    }
    
    .password-toggle:hover {
        color: var(--primary);
    }
    
    .btn-auth {
        width: 100%;
        padding: 0.75rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-base);
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .btn-primary {
        background-color: var(--primary);
        color: white;
    }
    
    .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .btn-outline-primary {
        background-color: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
    }
    
    .btn-outline-primary:hover {
        background-color: var(--primary-light);
        color: white;
    }
    
    .auth-divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
        color: var(--text-tertiary);
    }
    
    .auth-divider::before,
    .auth-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background-color: var(--border-light);
    }
    
    .auth-divider-text {
        padding: 0 1rem;
        font-size: 0.875rem;
    }
    
    .auth-footer {
        text-align: center;
        margin-top: 1.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .auth-footer a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
    }
    
    .auth-footer a:hover {
        text-decoration: underline;
    }
    
    .back-home-link {
        display: inline-flex;
        align-items: center;
        color: var(--text-secondary);
        text-decoration: none;
        margin-top: 1rem;
        transition: color 0.2s ease;
    }
    
    .back-home-link:hover {
        color: var(--primary);
        text-decoration: none;
    }
    
    /* Dark mode adjustments */
    [data-theme="dark"] .form-control {
        background-color: var(--bg-secondary);
        border-color: var(--border-medium);
    }
    
    [data-theme="dark"] .btn-outline-primary {
        border-color: var(--primary);
        color: var(--primary);
    }
    
    [data-theme="dark"] .btn-outline-primary:hover {
        background-color: var(--primary);
        color: white;
    }
    /* Auth Layout */
    .auth-container {
        max-width: 400px;
        margin: 0 auto;
        padding: 2rem 0;
    }
    
    .auth-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .auth-icon {
        font-size: 3rem;
        color: var(--primary);
        margin-bottom: 1rem;
    }
    
    .auth-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .auth-subtitle {
        color: var(--text-secondary);
        margin-bottom: 0;
    }
    
    /* Form Styles */
    .auth-form .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-primary);
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--border-light);
        border-radius: 8px;
        font-size: 1rem;
        transition: all var(--transition-base);
        background-color: var(--bg-primary);
        color: var(--text-primary);
    }
    
    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(88, 204, 2, 0.15);
        outline: none;
    }
    
    .btn-auth {
        width: 100%;
        padding: 0.75rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-base);
    }
    
    .btn-primary {
        background-color: var(--primary);
        color: white;
    }
    
    .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .btn-google {
        background-color: #fff;
        color: #3c4043;
        border: 1px solid #dadce0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
    }
    
    .btn-google:hover {
        background-color: #f8f9fa;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .auth-divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
        color: var(--text-tertiary);
    }
    
    .auth-divider::before,
    .auth-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background-color: var(--border-light);
    }
    
    .auth-divider-text {
        padding: 0 1rem;
        font-size: 0.875rem;
    }
    
    .auth-footer {
        text-align: center;
        margin-top: 1.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .auth-footer a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
    }
    
    .auth-footer a:hover {
        text-decoration: underline;
    }
    
    /* Dark mode adjustments */
    [data-theme="dark"] .form-control {
        background-color: var(--bg-secondary);
        border-color: var(--border-medium);
    }
    
    [data-theme="dark"] .btn-google {
        background-color: var(--bg-secondary);
        border-color: var(--border-medium);
        color: var(--text-primary);
    }
    
    [data-theme="dark"] .btn-google:hover {
        background-color: var(--bg-tertiary);
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="auth-container">
        <div class="auth-header">
            <div class="auth-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="auth-title">Welcome Back</h1>
            <p class="auth-subtitle">Sign in to continue your learning journey</p>
        </div>

        <div class="card">
            <div class="card-body">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert {% if message.tags %}{{ message.tags }}{% else %}info{% endif %} mb-4">
                            <div class="alert-icon">
                                <i class="fas fa-{% if message.tags == 'error' %}exclamation{% else %}check{% endif %}-circle"></i>
                            </div>
                            <div class="alert-content">
                                {{ message }}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}

                <form method="post" id="loginForm" class="auth-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="id_username" class="form-label">
                            Username or Email
                        </label>
                        <input type="text"
                               class="form-control"
                               id="id_username"
                               name="username"
                               placeholder="Enter your username or email"
                               required
                               autocomplete="username">
                        {% if form.username.errors %}
                            <div class="invalid-feedback">
                                <i class="fas fa-exclamation-triangle me-1"></i>{{ form.username.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_password" class="form-label">
                            Password
                        </label>
                        <div class="password-field-wrapper">
                            <input type="password"
                                   class="form-control"
                                   id="id_password"
                                   name="password"
                                   placeholder="Enter your password"
                                   required
                                   autocomplete="current-password">
                            <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% if form.password.errors %}
                            <div class="invalid-feedback">
                                <i class="fas fa-exclamation-triangle me-1"></i>{{ form.password.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="remember_me" name="remember_me">
                            <label class="form-check-label" for="remember_me">
                                Remember me
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn-auth btn-primary" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </div>

                    <div class="auth-divider">
                        <span class="auth-divider-text">or</span>
                    </div>

                    <div class="form-group">
                        <button type="button" class="btn-auth btn-outline-primary" disabled>
                            <i class="fab fa-google"></i> Continue with Google
                        </button>
                    </div>

                    <div class="auth-footer">
                        <p>
                            Don't have an account?
                            <a href="{% url 'accounts:register' %}">Sign up</a>
                        </p>
                        <a href="{% url 'gamify_ai:home' %}" class="back-home-link">
                            <i class="fas fa-arrow-left"></i> Back to Home
                        </a>
                    </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    const togglePassword = document.querySelector('.password-toggle');
    if (togglePassword) {
        togglePassword.addEventListener('click', function() {
            const passwordInput = document.querySelector('#id_password');
            const isPassword = passwordInput.type === 'password';
            const icon = this.querySelector('i');
            
            // Toggle password visibility
            passwordInput.type = isPassword ? 'text' : 'password';
            
            // Toggle icon
            if (icon) {
                icon.classList.toggle('fa-eye', !isPassword);
                icon.classList.toggle('fa-eye-slash', isPassword);
            }

            // Enhanced click animation with ripple effect
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: rgba(99, 102, 241, 0.2);
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                pointer-events: none;
                z-index: 1;
            `;

            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);

            // Simple click feedback without position changes
            this.style.opacity = '0.8';
            setTimeout(() => {
                this.style.opacity = '1';
            }, 150);
        });
    }

    // --- Advanced Real-time Form Validation ---
    const formInputs = document.querySelectorAll('.auth-input');
    formInputs.forEach(input => {
        // Add input event for real-time feedback
        input.addEventListener('input', function() {
            const formGroup = this.closest('.form-floating');

            // Remove error styling if input has content and passes basic validation
            if (this.value.trim() && formGroup.classList.contains('input-error')) {
                // Basic validation check
                let isValid = true;
                if (this.type === 'email' || this.name === 'username') {
                    isValid = this.value.length >= 3;
                } else if (this.type === 'password') {
                    isValid = this.value.length >= 6;
                }

                if (isValid) {
                    formGroup.classList.remove('input-error');
                    formGroup.classList.add('input-valid');
                }
            }

            // Enhanced visual feedback for filled inputs
            if (this.value.trim()) {
                this.style.background = 'linear-gradient(135deg, rgba(236, 254, 255, 0.8) 0%, rgba(219, 234, 254, 0.3) 100%)';
                this.style.borderColor = 'rgba(59, 130, 246, 0.4)';
            } else {
                this.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%)';
                this.style.borderColor = 'rgba(99, 102, 241, 0.2)';
            }
        });

        // Enhanced focus effects
        input.addEventListener('focus', function() {
            this.style.transform = 'translateY(-1px) scale(1.01)';
            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        });

        input.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%)';
                this.style.borderColor = 'rgba(99, 102, 241, 0.2)';
                this.style.transform = 'translateY(0) scale(1)';
            }
        });

        // Add typing animation effect
        input.addEventListener('keydown', function() {
            this.style.transform = 'translateY(-1px) scale(1.005)';
        });

        input.addEventListener('keyup', function() {
            this.style.transform = 'translateY(-1px) scale(1.01)';
        });
    });

    // --- Auto-hide Django messages alerts ---
    document.querySelectorAll('.alert-enhanced').forEach((alert, index) => {
        setTimeout(() => {
            alert.style.transition = 'opacity 0.5s ease, transform 0.5s ease, margin 0.5s ease';
            alert.style.opacity = '0';
            alert.style.transform = 'translateY(-20px)';
            alert.style.marginTop = '0';
            alert.style.marginBottom = '0';
            alert.style.paddingTop = '0';
            alert.style.paddingBottom = '0';
            setTimeout(() => alert.remove(), 500);
        }, 5000 + (index * 500));
    });

    // --- Staggered entrance animations for form elements ---
    const animatedElements = document.querySelectorAll('.auth-header, .form-floating, .row.mb-4, .d-grid, .auth-divider, .text-center');
    animatedElements.forEach((element, index) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(20px)';
        element.style.transition = `opacity 0.6s ease-out ${index * 0.05}s, transform 0.6s ease-out ${index * 0.05}s`;

        // Use a small timeout to apply the 'in-view' state, triggering the transition
        setTimeout(() => {
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }, 100);
    });
});
</script>
{% endblock %}